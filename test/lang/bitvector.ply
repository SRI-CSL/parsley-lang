type bv = bitvector<1>

bitfield bf = {
  top: 8:7,
  bot: 6:0
}

fun test_bitvector(b: bitvector<3>) -> bitvector<3> = {
  b[[2:0]]
}

fun test_bitfield (r: bf) -> (bitvector<2>, bitvector<7>) = {
  (r.top, r.bot)
}

fun test_rop_record(r: bitvector<9>) -> bf = {
  bf->record(r)
}

fun test_rop_bits(r: bf) -> bitvector<9> = {
  bf->bits(r)
}

format {
  N n {v: bitvector<7>, f: bf, t: bitvector<2>, b: bitvector<7>} :=
    BitVector<1> $pad<8, 0b01> $align<8> v=BitVector<7> f=$bitfield(bf)
    { n.v := v;
      n.f := f;
      n.t := f.top;
      n.b := f.bot }
}
